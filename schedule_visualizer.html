<html>
<head>
<title>HackEPS 2022</title>
<link rel="stylesheet" href="main.css">
</head>

<h1> Origen studio challenge: Job Shop Problem</h1>
<div id="container">
    <div style="width: 40%; float: left">
        <form id="upload">
            <label for="file">Choose the input json:</label>
            <input type="file" id="file" accept=".json">
            <button>Upload!</button>
        </form>
            <!--<select id="input" onchange="changeInput()"></select> -->
    </div>
    <div style="width: 40%; float: left">
        <label for="file">Choose the challenge:</label>
        <select id="challenge" onchange = "dropdownMenu()"> 
        <option> - </option>        
        <option> Challenge1 </option>  
        <option> Challenge2 </option>    
        </select> 
    </div>
</div>

<br></br>

<div>
    <div>
        <div id="scheduleStyle">
            <table id="scheduleTable"></table>
        </div>
        <div id="legendStyle">
            <table id="legend"></table>
        </div>    
    </div>
</div>

<br></br>
<div>
    <form>
        <button type="button" onclick="computeSchedule()">Compute schedule</button>
    </form>    
</div>

<script type="text/javascript" src="computation.js"></script>
<script type="text/javascript" src="drawSchedule.js"></script>
<script type="text/javascript">


let form = document.querySelector('#upload');
let file = document.querySelector('#file');
form.addEventListener('submit', handleSubmit);

function handleSubmit (event) {
    // Evitem que es recarregui la p√†gina
    event.preventDefault();
    // Si no tenim cap fitxer no fem res
    if (!file.value.length) return;
    let reader = new FileReader();
    reader.onload = logFile;
    // Llegim el fitxer
    reader.readAsText(file.files[0]);
    console.log(reader);
}

function logFile (event) {
    let str = event.target.result;
	let json = JSON.parse(str);
	//console.log('string', str);
	console.log('json', json);  
}

function fillInputSelection() {
    //addOptGroup("Challenge 1", filesChallenge1);
    //addOptGroup("Challenge 2", filesChallenge2);
    let label = document.createElement("label");
    label.innerHTML = "Choose the input json: "
    label.htmlFor = "input";
    let select = document.getElementById('input');

    let spacer = document.createElement("label");
    spacer.innerHTML = "Holaa: "
    spacer.htmlFor = "label";

    document.getElementById("container").appendChild(label).appendChild(select);
}

function addOptGroup(labelName, files) {
    let select = document.getElementById('input');

    let optgroup = document.createElement("OPTGROUP");
    optgroup.label = labelName;

    for (const file of files) {
        let opt = document.createElement("option");
        opt.value = file;
        opt.text = file;
        optgroup.appendChild(opt);
    }
    select.appendChild(optgroup);
}

function dropdownMenu() {  
    var list = document.getElementById("challenge");  
    document.getElementById("challenge").value = list.options[list.selectedIndex].text; 
    var index = list.options[list.selectedIndex].text;
}  

function computeSchedule() {
    // Compute schedule and paint it
    var list = document.getElementById("challenge"); 
    document.getElementById("challenge").value = list.options[list.selectedIndex].text; 
    var nomOpcio = list.options[list.selectedIndex].text;
    let valorChallenge = nomOpcio.slice(-1);
    let path = "challenge_" + challenge + "/" + valorChallenge;

    let outputJSON = [];
    if (valorChallenge == 1) {
        outputJSON = computeChallenge1(path);
        drawSchedule1(outputJSON);
    } else if (valorChallenge == 2) {
        outputJSON = computeChallenge2(path);
        drawSchedule2(outputJSON);
    } else {
        console.log("You have to choose a challenge!")
    }
}

</script>
</html>